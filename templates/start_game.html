<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistory</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='icons/favicon.png') }}" type="image/png">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>
<body data-solution-image="{{ session['solution_details']['image_url'] }}" data-solution-text="{{ session['solution_details']['solution_text'] }}" data-questions-asked="{{ session.get('questions_asked', 0) }}">
    <!-- Top Ad Placeholder -->
    <!-- <div class="ad-placeholder top-ad">YOUR AD</div> -->
    
    <div class="main-content-wrapper">
        <!-- Left Side Ad Placeholder -->
        <!-- <div class="ad-placeholder side-ad left-ad">YOUR AD</div> -->
        <div class="wrapper">
            <div class="top-bar">
                <!-- Dropdown Button -->
                <button class="dropdown-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.5 6.5A.5.5 0 0 1 3 6h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0 3A.5.5 0 0 1 3 9h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0 3A.5.5 0 0 1 3 12h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                </button>

                <!-- Dropdown Menu -->
                <div class="dropdown" style="display: none;">
                    <button type="button" class="menu-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                          </svg>
                        Settings
                    </button>
                    <button type="button" class="menu-item change-mystery-trigger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>
                            <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>
                        </svg>
                        Change Mystery
                    </button>
                    <div class="mystery-dropdown" style="display: none;">
                        <form action="/start_game" method="post">
                            <select name="id" id="changeMystery" onchange="this.form.submit()">
                                <!-- Options will be dynamically generated based on the total mysteries -->
                                {% for i in range(1, total_mysteries + 1) %}
                                    <option value="{{ i }}">Mystery {{ i }}</option>
                                {% endfor %}
                            </select>
                            <input type="hidden" name="change_mystery" value="true">
                        </form>
                    </div>
                    <button type="button" class="menu-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                            <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                          </svg>
                        How to Play
                    </button>
                    <button type="button" class="menu-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                        </svg>
                        Info
                    </button>
                </div>

                <div class="title">
                    <h1>
                        Mistory
                    </h1>
                    <h2 style=
                        "font-size: small;
                        opacity: 80%;
                        margin-block-start: -0.17em;">      
                        Designed by ChatGPT
                    </h2>
                </div>
                <!-- Dark Mode Toggle Button -->
                <label class="switch" id="darkModeSwitch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
                <!-- Other top bar content if necessary -->
            </div>
            <div class="info-bar">
                <span class="label">Description:</span> <span>#{{ mystery.id }}</span>&nbsp;&nbsp;
                <span class="label">Questions:</span> <span>{{ session.get('guess_count', 0) }}</span>&nbsp;&nbsp;
                <span class="label">Remaining:</span>
                <span class="questions-left"></span>
            </div>
            <div class="brief-description">
                <div class="message-text">{{ mystery.description }}</div>
            </div>

            {% if session.get('questions_asked', 0) < 15 %}
                <form method="POST" action="{{ url_for('ask_question') }}" style="margin-bottom: 20px;">
                    <input class="word" type="text" name="question" placeholder="Ask a yes-or-no question" autocapitalize="off" autocomplete="off" enterkeyhint="send" maxlength="70" >
                </form>
            {% else %}
                <!-- Get more questions button -->
                <button id="getMoreQuestionsButton">Get More Questions</button>
            {% endif %}

            <!-- Ad Modal -->
            <div id="adModal" class="modal">
                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="adContent">
                        <!-- Placeholder for ad -->
                        <p>YOUR VIDEO AD</p>
                        <button id="skipAdButton" onclick="location.href='{{ url_for('add_questions') }}'">Skip Ad</button>
                    </div>
                </div>
            </div>


            {% if not session['qa_history'] %}
            <div class="collapsible-sections">
                <!-- How to Play -->
                <div class="row-wrapper collapsible">
                    <div class="row collapsible-header" data-target="howToPlayContent">
                        <span>How to Play</span><span class="expand-icon"></span>
                    </div>
                    <div id="howToPlayContent" class="collapsible-content">
                        <p>Find the secret story behind the given description, by only asking yes-or-no questions.</p>
                        <p>The secret story has all the specific details you need to uncover. It generally includes details about the characters, location, events, and motivations.</p>
                        <p>Behind the scenes, an artificial intelligence is provided with the solution. It answers your questions with either "Yes", "No", "Irrelevant", or "Omitted". It generally interprets the story like a human — but not always!</p>
                        <p>Consider the essential elements: who, what, when, where, why. Be efficient in your questions, and most importantly, think outside the box!</p>
                    </div>
                </div>
            
                <!-- How is the Answer Evaluated? -->
                <div class="row-wrapper collapsible">
                    <div class="row collapsible-header" data-target="answerEvalContent">
                        <span>How is the Answer Evaluated?</span><span class="expand-icon"></span>
                    </div>
                    <div id="answerEvalContent" class="collapsible-content">
                        <!-- Answer Evaluation content goes here -->
                    </div>
                </div>
            
                <!-- Tips and Tricks -->
                <div class="row-wrapper collapsible">
                    <div class="row collapsible-header" data-target="tipsTricksContent">
                        <span>Tips and Tricks</span><span class="expand-icon"></span>
                    </div>
                    <div id="tipsTricksContent" class="collapsible-content">
                        <!-- Tips and Tricks content goes here -->
                    </div>
                </div>
            
                <!-- Credits -->
                <div class="row-wrapper collapsible">
                    <div class="row collapsible-header" data-target="creditsContent">
                        <span>Credits</span><span class="expand-icon"></span>
                    </div>
                    <div id="creditsContent" class="collapsible-content">
                        <!-- Credits content goes here -->
                    </div>
                </div>
            </div>
            
            {% endif %}
        
        

            <!-- Display the most recent question -->
            {% if session['qa_history'] %}
            <div class="message">
                {% for qa in session['qa_history']|reverse %}
                {% if loop.first %}
                <div class="row-wrapper current {{ qa.css_class }}" style="border-radius: 10px;">
                    <div class="row">
                        <span>{{ qa.question }}</span>
                        <span>{{ qa.answer }}</span>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- Display the guess history with the most recent first, excluding the current question -->
            <div class="guess-history">
                {% for qa in session['qa_history'][:-1]|reverse %}
                <div class="row-wrapper {{ qa.css_class }}" style="border-radius: 10px;">
                    <div class="row">
                        <span>{{ qa.question }}</span>
                        <span>{{ qa.answer }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}


            <button type="button" onclick="window.location.href='{{ url_for('reset_game') }}'">Reset Game</button>
            
            <button type="button" id="checkAnswerButton">Check Your Answer</button>
            
            <div id="answerModal" class="modal">
                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="termometer">
                        <div id="temperature" style="height:0" data-value="0°C"></div>
                        <div class="graduation" style="top: 20%;"></div>
                        <div class="graduation" style="top: 35%;"></div>
                        <div class="graduation" style="top: 50%;"></div>
                        <div class="graduation" style="top: 65%;"></div>
                        <div class="graduation" style="top: 80%;"></div>
                    </div>
                    <div id="submitAnswerSection">
                        <form id="answerForm" method="POST" action="{{ url_for('check_answer') }}">
                            <textarea class="word" name="interpretation" placeholder="Enter your version of the story..." maxlength="{{ mystery.solution|length }}"></textarea>
                            <button type="submit">Verify</button>
                        </form>
                    </div>
                    <div class="bottom-section">
                        <div id="tipMessage"> The score is based on the AI's interpretation.<br>
                            It might not be the same as a human.</div>
                        <button id="seeSolutionButton">Solution</button>
                    </div>
                </div>
                    
                <!-- New modal for solution -->
                <div id="solutionModal" class="modal" style="display: none;">
                    <div class="modal-content" style="width: min(65%, 425px);">
                        <span class="close">&times;</span>
                        <div class="solution-text">
                            <h3>Solution</h3>
                            <p></p> <!-- Solution text will be set dynamically -->
                        </div>
                        <div class="solution-visualization">
                            <img src="" alt="Solution Visualization"> <!-- Image URL will be set dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Side Ad Placeholder -->
        <!-- <div class="ad-placeholder side-ad right-ad">YOUR AD</div> -->
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
